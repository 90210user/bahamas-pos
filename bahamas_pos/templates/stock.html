{% extends 'base.html' %}
{% block content %}
<h4 class="mb-3">Add Stock</h4>
<form method="post" class="row g-3 mb-4">
  <input type="hidden" name="action" value="add" />
  <div class="col-12 col-md-4">
    <label class="form-label">Item Name</label>
    <input class="form-control" name="name" required />
  </div>
  <div class="col-6 col-md-3">
    <label class="form-label">Type</label>
    <select class="form-select" name="type">
      <option value="product">Product</option>
      <option value="service">Service</option>
    </select>
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Base Price (legacy)</label>
    <input type="number" class="form-control" step="0.01" min="0" name="price" required />
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Buying Price</label>
    <input type="number" class="form-control" step="0.01" min="0" name="buying_price" value="0" />
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Selling Price</label>
    <input type="number" class="form-control" step="0.01" min="0" name="selling_price" />
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Quantity</label>
    <input type="number" class="form-control" min="0" name="quantity" value="0" />
  </div>
  <div class="col-12">
    <button class="btn btn-accent">Add Item</button>
  </div>
</form>

<h5 class="mb-2">Current Items</h5>
<form method="post" class="mb-3">
  <input type="hidden" name="action" value="delete_selected" />
  <div class="mb-2">
    <button class="btn btn-danger btn-sm" onclick="return confirm('Delete selected items?')">Delete Selected</button>
  </div>
  <div class="table-responsive">
  <table class="table table-sm table-hover align-middle">
    <thead>
      <tr>
        <th><input type="checkbox" onclick="document.querySelectorAll('input[name=selected]').forEach(cb=>cb.checked=this.checked)" /></th>
        <th>Code</th>
        <th>Name</th>
        <th>Type</th>
        <th>Buying Price</th>
        <th>Selling Price</th>
        <th>Price (Legacy)</th>
        <th>Quantity</th>
        <th>Edit</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td><input type="checkbox" name="selected" value="{{ it.code }}" /></td>
        <td>{{ it.code }}</td>
        <td>{{ it.name }}</td>
        <td>{{ it.type }}</td>
        <td>KES {{ '%.2f'|format(it.buying_price or 0) }}</td>
        <td>KES {{ '%.2f'|format(it.selling_price or it.price) }}</td>
        <td>KES {{ '%.2f'|format(it.price) }}</td>
        <td>{{ it.quantity }}</td>
        <td>
          <form method="post" class="d-flex gap-2 align-items-center">
            <input type="hidden" name="action" value="update" />
            <input type="hidden" name="code" value="{{ it.code }}" />
            <input class="form-control form-control-sm" style="max-width: 160px" name="name" value="{{ it.name }}" />
            <input type="number" step="0.01" min="0" class="form-control form-control-sm" style="max-width: 120px" name="buying_price" value="{{ it.buying_price or 0 }}" />
            <input type="number" step="0.01" min="0" class="form-control form-control-sm" style="max-width: 120px" name="selling_price" value="{{ it.selling_price or it.price }}" />
            <input type="number" min="0" class="form-control form-control-sm" style="max-width: 100px" name="quantity" value="{{ it.quantity }}" />
            <button class="btn btn-sm btn-accent">Save</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</form>
{% endblock %}



